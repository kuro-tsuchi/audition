# 1. summary

## 1.1. 控制出款风险的总原则

1. 先扣款,再生成处理订单
1. 自动校验商户的结算记录和客户出款记录,不允许同一天同一金额的结算记录产生多条.如果同一客户相同金额的多笔出款,建议列入异常,由人工复核.
1. 只要进入处理流程,先标记"处理中",对于"处理中"的订单,不能再重复自动发起
1. 除了成功之外,所有的其他通知的,都列为异常,需要人工处理
1. 异常的交易,需要定时器主动查询1小时后,再放给财务重新处理出款
1. 不允许同一付款的定时器在多台服务器开启.
1. 审核提交等,加上前后端的防并发处理,防范http的retry.

## 1.2. 对账

核对账目

## 1.3. 账变场景

充值, 提现, 游戏,活动奖金, 钱包转账(转入 , 转出)

## 利用 Session 防止表单重复提交

服务器返回表单页面时，会先生成一个 subToken 保存于 session，并把该 subToen 传给表单页面。当表单提交时会带上 subToken，服务器拦截器 Interceptor 会拦截该请求，拦截器判断 session 保存的 subToken 和表单提交 subToken 是否一致。若不一致或 session 的 subToken 为空或表单未携带 subToken 则不通过。

首次提交表单时 session 的 subToken 与表单携带的 subToken 一致走正常流程，然后拦截器内会删除 session 保存的 subToken。当再次提交表单时由于 session 的 subToken 为空则不通过。从而实现了防止表单重复提交。
