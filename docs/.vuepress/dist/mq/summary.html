<!DOCTYPE html>
<html lang="en-EN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.27">
    <title>1. summary | 努力！奋斗！</title><meta name="description" content="">
    <link rel="preload" href="/assets/js/runtime~app.61cd9db0.js" as="script"><link rel="preload" href="/assets/css/styles.b61067da.css" as="style"><link rel="preload" href="/assets/js/812.cf73d600.js" as="script"><link rel="preload" href="/assets/js/app.bb1ab572.js" as="script">
    <link rel="stylesheet" href="/assets/css/styles.b61067da.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><!----><span class="site-name can-hide">努力！奋斗！</span></a></span><div class="navbar-links-wrapper" style=""><!--[--><!--]--><nav class="navbar-links can-hide"><!--[--><div class="navbar-links-item"><a href="/" class="nav-link" aria-label="home"><!--[--><!--]--> home <!--[--><!--]--></a></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="java"><span class="title">java</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="java"><span class="title">java</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/java/basic" class="nav-link" aria-label="basic"><!--[--><!--]--> basic <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/java/collection" class="nav-link" aria-label="collection"><!--[--><!--]--> collection <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/java/multithreadingbasic" class="nav-link" aria-label="multithreadingbasic"><!--[--><!--]--> multithreadingbasic <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/java/multithreadingadvanced" class="nav-link" aria-label="multithreadingadvanced"><!--[--><!--]--> multithreadingadvanced <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/java/jvm" class="nav-link" aria-label="jvm"><!--[--><!--]--> jvm <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="spring"><span class="title">spring</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="spring"><span class="title">spring</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/spring/springboot" class="nav-link" aria-label="springboot"><!--[--><!--]--> springboot <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/spring/mybatis" class="nav-link" aria-label="mybatis"><!--[--><!--]--> mybatis <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="springcloud"><span class="title">springcloud</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="springcloud"><span class="title">springcloud</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/springcloud/nacos" class="nav-link" aria-label="nacos"><!--[--><!--]--> nacos <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/springcloud/summary" class="nav-link" aria-label="summary"><!--[--><!--]--> summary <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="microservice"><span class="title">microservice</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="microservice"><span class="title">microservice</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/microservice/zookeeper" class="nav-link" aria-label="zookeeper"><!--[--><!--]--> zookeeper <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/microservice/dubbo" class="nav-link" aria-label="dubbo"><!--[--><!--]--> dubbo <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="mq"><span class="title">mq</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="mq"><span class="title">mq</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/mq/summary" class="nav-link router-link-active" aria-label="summary"><!--[--><!--]--> summary <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/mq/kafka" class="nav-link" aria-label="kafka"><!--[--><!--]--> kafka <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/mq/rocketmq" class="nav-link" aria-label="rocketmq"><!--[--><!--]--> rocketmq <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="database"><span class="title">database</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="database"><span class="title">database</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/database/mysql" class="nav-link" aria-label="mysql"><!--[--><!--]--> mysql <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/database/redis" class="nav-link" aria-label="redis"><!--[--><!--]--> redis <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="additional"><span class="title">additional</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="additional"><span class="title">additional</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/additional/linux" class="nav-link" aria-label="linux"><!--[--><!--]--> linux <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><a href="/interview/" class="nav-link" aria-label="interview"><!--[--><!--]--> interview <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-links"><!--[--><div class="navbar-links-item"><a href="/" class="nav-link" aria-label="home"><!--[--><!--]--> home <!--[--><!--]--></a></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="java"><span class="title">java</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="java"><span class="title">java</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/java/basic" class="nav-link" aria-label="basic"><!--[--><!--]--> basic <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/java/collection" class="nav-link" aria-label="collection"><!--[--><!--]--> collection <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/java/multithreadingbasic" class="nav-link" aria-label="multithreadingbasic"><!--[--><!--]--> multithreadingbasic <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/java/multithreadingadvanced" class="nav-link" aria-label="multithreadingadvanced"><!--[--><!--]--> multithreadingadvanced <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/java/jvm" class="nav-link" aria-label="jvm"><!--[--><!--]--> jvm <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="spring"><span class="title">spring</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="spring"><span class="title">spring</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/spring/springboot" class="nav-link" aria-label="springboot"><!--[--><!--]--> springboot <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/spring/mybatis" class="nav-link" aria-label="mybatis"><!--[--><!--]--> mybatis <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="springcloud"><span class="title">springcloud</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="springcloud"><span class="title">springcloud</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/springcloud/nacos" class="nav-link" aria-label="nacos"><!--[--><!--]--> nacos <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/springcloud/summary" class="nav-link" aria-label="summary"><!--[--><!--]--> summary <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="microservice"><span class="title">microservice</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="microservice"><span class="title">microservice</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/microservice/zookeeper" class="nav-link" aria-label="zookeeper"><!--[--><!--]--> zookeeper <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/microservice/dubbo" class="nav-link" aria-label="dubbo"><!--[--><!--]--> dubbo <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="mq"><span class="title">mq</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="mq"><span class="title">mq</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/mq/summary" class="nav-link router-link-active" aria-label="summary"><!--[--><!--]--> summary <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/mq/kafka" class="nav-link" aria-label="kafka"><!--[--><!--]--> kafka <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/mq/rocketmq" class="nav-link" aria-label="rocketmq"><!--[--><!--]--> rocketmq <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="database"><span class="title">database</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="database"><span class="title">database</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/database/mysql" class="nav-link" aria-label="mysql"><!--[--><!--]--> mysql <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/database/redis" class="nav-link" aria-label="redis"><!--[--><!--]--> redis <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="additional"><span class="title">additional</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="additional"><span class="title">additional</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/additional/linux" class="nav-link" aria-label="linux"><!--[--><!--]--> linux <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><a href="/interview/" class="nav-link" aria-label="interview"><!--[--><!--]--> interview <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--[--><p class="sidebar-heading sidebar-item active">mq</p><ul class=""><li><!--[--><a aria-current="page" href="/mq/summary.html" class="router-link-active router-link-exact-active nav-link router-link-active sidebar-item active" aria-label="1. summary"><!--[--><!--]--> 1. summary <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/mq/summary.html#_1-1-什么是消息队列" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="1.1. 什么是消息队列"><!--[--><!--]--> 1.1. 什么是消息队列 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/mq/summary.html#_1-2-为什么要用消息队列" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="1.2. 为什么要用消息队列"><!--[--><!--]--> 1.2. 为什么要用消息队列 <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/mq/summary.html#_1-2-1-通过异步处理提高系统性能-减少响应时间" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="1.2.1. 通过异步处理提高系统性能，减少响应时间"><!--[--><!--]--> 1.2.1. 通过异步处理提高系统性能，减少响应时间 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/mq/summary.html#_1-2-2-解耦" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="1.2.2. 解耦"><!--[--><!--]--> 1.2.2. 解耦 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/mq/summary.html#_1-2-3-削峰-限流" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="1.2.3. 削峰/限流"><!--[--><!--]--> 1.2.3. 削峰/限流 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/mq/summary.html#_1-3-使用消息队列带来的一些问题" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="1.3. 使用消息队列带来的一些问题"><!--[--><!--]--> 1.3. 使用消息队列带来的一些问题 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/mq/summary.html#_1-4-jms-vs-amqp" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="1.4. JMS VS AMQP"><!--[--><!--]--> 1.4. JMS VS AMQP <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/mq/summary.html#_1-4-1-jms-简介" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="1.4.1. JMS 简介"><!--[--><!--]--> 1.4.1. JMS 简介 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/mq/summary.html#_1-4-2-jms-两种消息模型" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="1.4.2. JMS 两种消息模型"><!--[--><!--]--> 1.4.2. JMS 两种消息模型 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/mq/summary.html#_1-4-3-jms-五种不同的消息正文格式" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="1.4.3. JMS 五种不同的消息正文格式"><!--[--><!--]--> 1.4.3. JMS 五种不同的消息正文格式 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/mq/summary.html#_1-4-4-amqp" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="1.4.4. AMQP"><!--[--><!--]--> 1.4.4. AMQP <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/mq/summary.html#_1-4-5-amqp-模型的几大组件" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="1.4.5. AMQP 模型的几大组件？"><!--[--><!--]--> 1.4.5. AMQP 模型的几大组件？ <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/mq/summary.html#_1-4-6-jms-vs-amqp" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="1.4.6. JMS vs AMQP"><!--[--><!--]--> 1.4.6. JMS vs AMQP <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/mq/summary.html#_1-5-常见的消息队列对比" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="1.5. 常见的消息队列对比"><!--[--><!--]--> 1.5. 常见的消息队列对比 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a href="/mq/rocketmq.html" class="nav-link sidebar-item" aria-label="1. RocketMQ"><!--[--><!--]--> 1. RocketMQ <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/mq/kafka.html" class="nav-link sidebar-item" aria-label="1. kafka"><!--[--><!--]--> 1. kafka <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="_1-summary" tabindex="-1"><a class="header-anchor" href="#_1-summary" aria-hidden="true">#</a> 1. summary</h1><h2 id="_1-1-什么是消息队列" tabindex="-1"><a class="header-anchor" href="#_1-1-什么是消息队列" aria-hidden="true">#</a> 1.1. 什么是消息队列</h2><p><img src="/assets/img/1639964161612.6cb2b00a.png" alt="picture 6"> 消息队列 (Message Queue) 是一个存放消息的容器，当需要使用消息的时候，直接从容器中取出消息使用。</p><p>队列 Queue 是一种先进先出的数据结构，所以消费消息时也是按照顺序来消费。</p><h2 id="_1-2-为什么要用消息队列" tabindex="-1"><a class="header-anchor" href="#_1-2-为什么要用消息队列" aria-hidden="true">#</a> 1.2. 为什么要用消息队列</h2><p>使用消息队列主要是为了通过异步处理提高系统性能和解耦，削峰。</p><h3 id="_1-2-1-通过异步处理提高系统性能-减少响应时间" tabindex="-1"><a class="header-anchor" href="#_1-2-1-通过异步处理提高系统性能-减少响应时间" aria-hidden="true">#</a> 1.2.1. 通过异步处理提高系统性能，减少响应时间</h3><p><img src="/assets/img/1640734707838.526134d1.png" alt="picture 1"><br> 将用户的请求数据存储到消息队列之后就立即返回结果。随后，系统再对消息进行消费。</p><p>因为用户请求数据写入消息队列之后就立即返回给用户了，但是请求数据在后续的业务校验，写数据库等操作中可能失败。因此，使用消息队列进行异步处理之后，需要适当修改业务流程进行配合</p><blockquote><p>比如用户在提交订单之后，订单数据写入消息队列，不能立即返回用户订单提交成功，需要在消息队列的订单消费者进程真正处理完该订单之后，甚至出库后，再通过电子邮件或短信通知用户订单成功，以免交易纠纷。这就类似平时手机订火车票和电影票。</p></blockquote><h3 id="_1-2-2-解耦" tabindex="-1"><a class="header-anchor" href="#_1-2-2-解耦" aria-hidden="true">#</a> 1.2.2. 解耦</h3><p><img src="/assets/img/1640734855701.3af9f827.png" alt="picture 2"></p><p>生产者 (客户端) 发送消息到消息队列中去，接受者 (服务端) 处理消息，需要消费的系统直接去消息队列取消息进行消费即可，而不需要和其他系统有耦合，这显然也提高了系统的扩展性。</p><p>消息队列使利用发布 - 订阅模式工作，消息发送者 (生产者) 发布消息，一个或多个消息接受者 (消费者) 订阅消息。消息发送者 (生产者) 和消息接受者 (消费者) 之间没有直接耦合，消息发送者将消息发送至分布式消息队列即结束对消息的处理，消息接受者从分布式消息队列获取该消息后进行后续处理，并不需要知道该消息从何而来。对新增业务，只要对该类消息感兴趣，即可订阅该消息，对原有系统和业务没有任何影响，从而实现网站业务的可扩展性设计。</p><p>另外，为了避免消息队列服务器宕机造成消息丢失，会将成功发送到消息队列的消息存储在消息生产者服务器上，等消息真正被消费者服务器处理后才删除消息。在消息队列服务器宕机后，生产者服务器会选择分布式消息队列服务器集群中的其他服务器发布消息。</p><h3 id="_1-2-3-削峰-限流" tabindex="-1"><a class="header-anchor" href="#_1-2-3-削峰-限流" aria-hidden="true">#</a> 1.2.3. 削峰/限流</h3><p><img src="/assets/img/1640739176539.56dedbfb.png" alt="picture 4"></p><p>先将短时间高并发产生的事务消息存储在消息队列中，然后后端服务再慢慢根据自己的能力去消费这些消息，这样就避免直接把后端服务打垮掉。</p><blockquote><p>在电子商务一些秒杀，促销活动中，合理使用消息队列可以有效抵御促销活动刚开始大量订单涌入对系统的冲击。如下图所示：</p></blockquote><h2 id="_1-3-使用消息队列带来的一些问题" tabindex="-1"><a class="header-anchor" href="#_1-3-使用消息队列带来的一些问题" aria-hidden="true">#</a> 1.3. 使用消息队列带来的一些问题</h2><ol><li><p>系统可用性降低：</p><p>在加入 MQ 之前，不用考虑消息丢失或者说 MQ 挂掉等等的情况，但是，引入 MQ 之后就需要去考虑了！</p></li><li><p>系统复杂性提高：</p><p>加入 MQ 之后，需要保证消息没有被重复消费，处理消息丢失的情况，保证消息传递的顺序性等等问题！</p></li><li><p>一致性问题：</p><p>万一消息的真正消费者并没有正确消费消息就会导致数据不一致的情况了！</p></li></ol><h2 id="_1-4-jms-vs-amqp" tabindex="-1"><a class="header-anchor" href="#_1-4-jms-vs-amqp" aria-hidden="true">#</a> 1.4. JMS VS AMQP</h2><h3 id="_1-4-1-jms-简介" tabindex="-1"><a class="header-anchor" href="#_1-4-1-jms-简介" aria-hidden="true">#</a> 1.4.1. JMS 简介</h3><p>JMS(JAVA Message Service, java 消息服务) 是 java 的消息服务，JMS 的客户端之间可以通过 JMS 服务进行异步的消息传输。</p><p>JMS 是一个消息服务的标准或者说是规范，允许应用程序组件基于 JavaEE 平台创建，发送，接收和读取消息。它使分布式通信耦合度更低，消息服务更加可靠以及异步性。</p><h3 id="_1-4-2-jms-两种消息模型" tabindex="-1"><a class="header-anchor" href="#_1-4-2-jms-两种消息模型" aria-hidden="true">#</a> 1.4.2. JMS 两种消息模型</h3><h4 id="_1-4-2-1-点到点-p2p-模型" tabindex="-1"><a class="header-anchor" href="#_1-4-2-1-点到点-p2p-模型" aria-hidden="true">#</a> 1.4.2.1. 点到点 (P2P) 模型</h4><p><img src="/assets/img/1640739519156.a6976603.png" alt="picture 5"></p><p>使用队列 (Queue) 作为消息通信载体; 满足生产者与消费者模式，一条消息只能被一个消费者使用，未被消费的消息在队列中保留直到被消费或超时。</p><blockquote><p>比如：生产者发送 100 条消息的话，两个消费者来消费一般情况下两个消费者会按照消息发送的顺序各自消费一半</p></blockquote><h4 id="_1-4-2-2-发布-订阅-pub-sub-模型" tabindex="-1"><a class="header-anchor" href="#_1-4-2-2-发布-订阅-pub-sub-模型" aria-hidden="true">#</a> 1.4.2.2. 发布/订阅 (Pub/Sub) 模型</h4><p><img src="/assets/img/1640739602283.5521820f.png" alt="picture 6"></p><p>发布订阅模型 (Pub/Sub) 使用主题 (Topic) 作为消息通信载体，类似于广播模式; 发布者发布一条消息，该消息通过主题传递给所有的订阅者，在一条消息广播之后才订阅的用户则是收不到该条消息的。</p><h3 id="_1-4-3-jms-五种不同的消息正文格式" tabindex="-1"><a class="header-anchor" href="#_1-4-3-jms-五种不同的消息正文格式" aria-hidden="true">#</a> 1.4.3. JMS 五种不同的消息正文格式</h3><p>JMS 定义了五种不同的消息正文格式，以及调用的消息类型，允许发送并接收以一些不同形式的数据，简单文本 (TextMessage), 可序列化的对象 (ObjectMessage), 键值对 (MapMessage), 字节流 (BytesMessage), 原始值流 (StreamMessage)</p><h3 id="_1-4-4-amqp" tabindex="-1"><a class="header-anchor" href="#_1-4-4-amqp" aria-hidden="true">#</a> 1.4.4. AMQP</h3><p>AMQP (Advanced Message Queuing Protocol), 一个提供统一消息服务的应用层标准高级消息队列协议，是应用层协议的一个开放标准，为面向消息的中间件设计，兼容 JMS. 基于此协议的客户端与消息中间件可传递消息，并不受客户端/中间件同产品，不同的开发语言等条件的限制。</p><p>生产者将消息发送给交换器，交换器和队列绑定，RabbitMQ 就是基于 AMQP 协议实现的。</p><h3 id="_1-4-5-amqp-模型的几大组件" tabindex="-1"><a class="header-anchor" href="#_1-4-5-amqp-模型的几大组件" aria-hidden="true">#</a> 1.4.5. AMQP 模型的几大组件？</h3><ol><li>交换器 (Exchange):消息代理服务器中用于把消息路由到队列的组件。</li><li>队列 (Queue):用来存储消息的数据结构，位于硬盘或内存中。</li><li>绑定 (Binding): 一套规则，告知交换器消息应该将消息投递给哪个队列。</li></ol><h3 id="_1-4-6-jms-vs-amqp" tabindex="-1"><a class="header-anchor" href="#_1-4-6-jms-vs-amqp" aria-hidden="true">#</a> 1.4.6. JMS vs AMQP</h3><table><thead><tr><th style="text-align:left;">对比方向</th><th style="text-align:left;">JMS</th><th style="text-align:left;">AMQP</th></tr></thead><tbody><tr><td style="text-align:left;">定义</td><td style="text-align:left;">Java API</td><td style="text-align:left;">协议</td></tr><tr><td style="text-align:left;">跨语言</td><td style="text-align:left;">否</td><td style="text-align:left;">是</td></tr><tr><td style="text-align:left;">跨平台</td><td style="text-align:left;">否</td><td style="text-align:left;">是</td></tr><tr><td style="text-align:left;">支持消息类型</td><td style="text-align:left;">提供两种消息模型:1. 点对点 2. 发布/订阅</td><td style="text-align:left;">提供了五种消息模型:①direct exchange; ②fanout exchange; ③topic change; ④headers exchange; ⑤system exchange.本质来讲，后四种和 JMS 的 pub/sub 模型没有太大差别，仅是在路由机制上做了更详细的划分;</td></tr><tr><td style="text-align:left;">支持消息类型</td><td style="text-align:left;">支持多种消息类型</td><td style="text-align:left;">byte<a href="%E4%BA%8C%E8%BF%9B%E5%88%B6"></a></td></tr></tbody></table><p>总结：</p><ul><li>AMQP 为消息定义了线路层 (wire-level protocol) 的协议，而 JMS 所定义的是 API 规范。在 Java 体系中，多个 client 均可以通过 JMS 进行交互，不需要应用修改代码，但是其对跨平台的支持较差。而 AMQP 天然具有跨平台，跨语言特性。</li><li>JMS 支持 TextMessage, MapMessage 等复杂的消息类型; 而 AMQP 仅支持 byte[] 消息类型 (复杂的类型可序列化后发送).</li><li>由于 Exchange 提供的路由算法，AMQP 可以提供多样化的路由方式来传递消息到消息队列，而 JMS 仅支持 队列 和 主题/订阅 方式两种。</li></ul><h2 id="_1-5-常见的消息队列对比" tabindex="-1"><a class="header-anchor" href="#_1-5-常见的消息队列对比" aria-hidden="true">#</a> 1.5. 常见的消息队列对比</h2><table><thead><tr><th>对比方向</th><th>概要</th></tr></thead><tbody><tr><td>吞吐量</td><td>万级的 ActiveMQ 和 RabbitMQ 的吞吐量 (ActiveMQ 的性能最差) 要比十万级甚至是百万级的 RocketMQ 和 Kafka 低一个数量级。</td></tr><tr><td>可用性</td><td>都可以实现高可用.ActiveMQ 和 RabbitMQ 都是基于主从架构实现高可用性.RocketMQ 基于分布式架构. kafka 也是分布式的，一个数据多个副本，少数机器宕机，不会丢失数据，不会导致不可用</td></tr><tr><td>时效性</td><td>RabbitMQ 基于 erlang 开发，所以并发能力很强，性能极其好，延时很低，达到微秒级。其他三个都是 ms 级。</td></tr><tr><td>功能支持</td><td>除了 Kafka，其他三个功能都较为完备. Kafka 功能较为简单，主要支持简单的 MQ 功能，在大数据领域的实时计算以及日志采集被大规模使用，是事实上的标准</td></tr><tr><td>消息丢失</td><td>ActiveMQ 和 RabbitMQ 丢失的可能性非常低，RocketMQ 和 Kafka 理论上不会丢失。</td></tr></tbody></table><p>总结：</p><ul><li>ActiveMQ 的社区算是比较成熟，但是较目前来说，ActiveMQ 的性能比较差，而且版本迭代很慢，不推荐使用。</li><li>RabbitMQ 在吞吐量方面虽然稍逊于 Kafka 和 RocketMQ , 但是由于它基于 erlang 开发，所以并发能力很强，性能极其好，延时很低，达到微秒级。但是也因为 RabbitMQ 基于 erlang 开发，所以国内很少有公司有实力做 erlang 源码级别的研究和定制。如果业务场景对并发量要求不是太高 (十万级，百万级), 那这四种消息队列中，RabbitMQ 一定是的首选。如果是大数据领域的实时计算，日志采集等场景，用 Kafka 是业内标准的，绝对没问题，社区活跃度很高，绝对不会黄，何况几乎是全世界这个领域的事实性规范。</li><li>RocketMQ 阿里出品，Java 系开源项目，源代码可以直接阅读，然后可以定制自己公司的 MQ，并且 RocketMQ 有阿里巴巴的实际业务场景的实战考验.RocketMQ 社区活跃度相对较为一般，不过也还可以，文档相对来说简单一些，然后接口这块不是按照标准 JMS 规范走的有些系统要迁移需要修改大量代码。还有就是阿里出台的技术，得做好这个技术万一被抛弃，社区黄掉的风险，那如果们公司有技术实力我觉得用 RocketMQ 挺好的</li><li>Kafka 的特点其实很明显，就是仅仅提供较少的核心功能，但是提供超高的吞吐量，ms 级的延迟，极高的可用性以及可靠性，而且分布式可以任意扩展。同时 kafka 最好是支撑较少的 topic 数量即可，保证其超高吞吐量.kafka 唯一的一点劣势是有可能消息重复消费，那么对数据准确性会造成极其轻微的影响，在大数据领域中以及日志采集中，这点轻微影响可以忽略这个特性天然适合大数据实时计算以及日志收集。</li></ul><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><span class="meta-item-info">12/29/2021, 9:42:24 PM</span></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: shorestraydog@protonmail.com">shorestraydog</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><!----><span class="next"><a href="/mq/rocketmq.html" class="nav-link" aria-label="1. RocketMQ"><!--[--><!--]--> 1. RocketMQ <!--[--><!--]--></a> → </span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script src="/assets/js/runtime~app.61cd9db0.js" defer></script><script src="/assets/js/812.cf73d600.js" defer></script><script src="/assets/js/app.bb1ab572.js" defer></script>
  </body>
</html>
